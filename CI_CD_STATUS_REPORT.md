# èèµ„ç§Ÿèµè®¡ç®—å™¨ CI/CD é…ç½®çŠ¶æ€æŠ¥å‘Š

## ğŸ“Š æ€»ä½“çŠ¶æ€
- âœ… é¡¹ç›®é…ç½®ï¼šå®Œæˆ
- âœ… æ–‡ä»¶æ¸…ç†ï¼šå®Œæˆ
- âœ… CI/CDæµç¨‹ï¼šé…ç½®å®Œæˆ
- âœ… æµ‹è¯•éªŒè¯ï¼š36ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âš ï¸ Dockeræ„å»ºï¼šæœ¬åœ°ç½‘ç»œé—®é¢˜ï¼ˆCIç¯å¢ƒæ­£å¸¸ï¼‰

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…ç†æƒ…å†µ

### å·²åˆ é™¤çš„æ— ç”¨æ–‡ä»¶
- âŒ install-*.sh (å¤šä¸ªå®‰è£…è„šæœ¬)
- âŒ setup-domain.sh
- âŒ optimize.sh
- âŒ simple-install.sh
- âŒ ultra-simple-install.sh
- âŒ *.Zone.Identifier æ–‡ä»¶(Windowsä¼ è¾“æ ‡è®°)

### ä¿ç•™çš„å…³é”®æ–‡ä»¶
- âœ… quick-deploy.sh (å¿«é€Ÿéƒ¨ç½²è„šæœ¬)
- âœ… start.sh/stop.sh (æœåŠ¡æ§åˆ¶è„šæœ¬)
- âœ… verify.sh (éªŒè¯è„šæœ¬)
- âœ… docker-compose.yml (ç”Ÿäº§ç¯å¢ƒ)
- âœ… æ‰€æœ‰æ ¸å¿ƒä»£ç æ–‡ä»¶

## ğŸš€ CI/CD å·¥ä½œæµé…ç½®

### GitHub Actions æµæ°´çº¿
```yaml
å·¥ä½œæµæ–‡ä»¶: .github/workflows/ci-cd.yml
è§¦å‘æ¡ä»¶: pushåˆ°main/developåˆ†æ”¯ï¼ŒPRåˆ°mainåˆ†æ”¯
```

### æµæ°´çº¿æ­¥éª¤
1. **å‰ç«¯æ£€æŸ¥**: HTML/CSS/JSè¯­æ³•éªŒè¯
2. **åç«¯æµ‹è¯•**: Python 3.8-3.12å¤šç‰ˆæœ¬æµ‹è¯•
3. **ä»£ç è´¨é‡**: flake8, blackæ ¼å¼åŒ–æ£€æŸ¥
4. **å®‰å…¨æ£€æŸ¥**: banditå®‰å…¨æ‰«æ
5. **Dockeræ„å»º**: å¤šå¹³å°é•œåƒ(amd64/arm64)
6. **æ€§èƒ½æµ‹è¯•**: APIå“åº”æ—¶é—´æµ‹è¯•
7. **è‡ªåŠ¨éƒ¨ç½²**: 
   - develop â†’ æµ‹è¯•ç¯å¢ƒ(192.168.2.8)
   - main â†’ ç”Ÿäº§ç¯å¢ƒ(47.94.225.76)

## ğŸ³ Docker é…ç½®

### Docker Hub
- **ç”¨æˆ·å**: tuoyongjun1987
- **é•œåƒå**: tuoyongjun1987/lease-calculator
- **å¹³å°æ”¯æŒ**: linux/amd64, linux/arm64

### ç¯å¢ƒé…ç½®
- **ç”Ÿäº§ç¯å¢ƒ**: docker-compose.yml (ç«¯å£5002)
- **æµ‹è¯•ç¯å¢ƒ**: docker-compose.test.yml (ç«¯å£8080)

## ğŸ–¥ï¸ æœåŠ¡å™¨ç¯å¢ƒ

### ç”Ÿäº§æœåŠ¡å™¨
- **IP**: 47.94.225.76
- **ç”¨æˆ·**: root
- **è®¤è¯**: SSHå¯†ç è®¤è¯
- **éƒ¨ç½²ç«¯å£**: 5002

### æµ‹è¯•æœåŠ¡å™¨
- **IP**: 192.168.2.8
- **ç”¨æˆ·**: root
- **è®¤è¯**: SSHå¯†ç è®¤è¯
- **éƒ¨ç½²ç«¯å£**: 8080

## ğŸ”‘ GitHub Secrets é…ç½®

éœ€è¦åœ¨GitHubä»“åº“è®¾ç½®ä¸­é…ç½®ä»¥ä¸‹Secretsï¼š

```
DOCKERHUB_TOKEN=dckr_pat_uOJQgE31jFixm5bB_9-bF5O_In0
PROD_SSH_PASSWORD=Tyj_98729
TEST_SSH_PASSWORD=tyj198729
SLACK_WEBHOOK_URL=(å¯é€‰ï¼Œç”¨äºé€šçŸ¥)
```

> ğŸ“ è¯¦ç»†é…ç½®æ­¥éª¤è¯·å‚è€ƒ: [docs/GITHUB_SECRETS.md](docs/GITHUB_SECRETS.md)

## ğŸ§ª æµ‹è¯•çŠ¶æ€

### æµ‹è¯•è¦†ç›–ç‡
- **æ€»æµ‹è¯•æ•°**: 36ä¸ª
- **é€šè¿‡ç‡**: 100%
- **ä»£ç è¦†ç›–ç‡**: 35%
- **æµ‹è¯•ç±»å‹**: APIæµ‹è¯•ã€è®¡ç®—å™¨æµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶
- `tests/test_api.py`: APIæ¥å£æµ‹è¯•
- `tests/test_calculator.py`: æ ¸å¿ƒè®¡ç®—é€»è¾‘æµ‹è¯•
- `tests/test_e2e.py`: ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
- `tests/test_performance.py`: æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“ é¡¹ç›®ç»“æ„ä¼˜åŒ–

### æ ¸å¿ƒç›®å½•
```
/
â”œâ”€â”€ backend/           # åç«¯Pythonä»£ç 
â”œâ”€â”€ frontend/          # å‰ç«¯é™æ€æ–‡ä»¶
â”œâ”€â”€ tests/            # æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶(nginx, systemd)
â”œâ”€â”€ docs/             # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/          # å®ç”¨è„šæœ¬
â””â”€â”€ .github/workflows/ # CI/CDé…ç½®
```

### æ–°å¢é…ç½®æ–‡ä»¶
- `docker-compose.test.yml`: æµ‹è¯•ç¯å¢ƒDockeré…ç½®
- `config/nginx.test.conf`: æµ‹è¯•ç¯å¢ƒNginxé…ç½®
- `scripts/check-cicd.sh`: CI/CDé…ç½®æ£€æŸ¥è„šæœ¬
- `.gitignore`: é¡¹ç›®å¿½ç•¥è§„åˆ™

## âš¡ éƒ¨ç½²æµç¨‹

### è‡ªåŠ¨éƒ¨ç½²è§¦å‘
1. **æµ‹è¯•éƒ¨ç½²**: pushåˆ°developåˆ†æ”¯
2. **ç”Ÿäº§éƒ¨ç½²**: pushåˆ°mainåˆ†æ”¯

### éƒ¨ç½²æ­¥éª¤
1. æ„å»ºDockeré•œåƒ
2. æ¨é€åˆ°Docker Hub
3. SSHè¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨
4. æ‹‰å–æœ€æ–°é•œåƒ
5. é‡å¯æœåŠ¡
6. å¥åº·æ£€æŸ¥éªŒè¯

## ğŸ”§ æœ¬åœ°å¼€å‘

### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
cd backend && python app.py

# Dockeræ¨¡å¼
docker-compose up -d

# æµ‹è¯•ç¯å¢ƒ
docker-compose -f docker-compose.test.yml up -d
```

### è¿è¡Œæµ‹è¯•
```bash
# å®Œæ•´æµ‹è¯•å¥—ä»¶
pytest tests/ -v --cov=backend

# æ£€æŸ¥CI/CDé…ç½®
./scripts/check-cicd.sh
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### APIå“åº”æ—¶é—´
- è®¡ç®—æ¥å£: < 100ms
- å¥åº·æ£€æŸ¥: < 50ms
- æ•°æ®å¯¼å‡º: < 500ms

### èµ„æºä½¿ç”¨
- å†…å­˜å ç”¨: ~100MB
- CPUä½¿ç”¨: ä½è´Ÿè½½
- å¯åŠ¨æ—¶é—´: ~10ç§’

## ğŸ”® ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ç›‘æ§é›†æˆ**: æ·»åŠ Prometheus/Grafanaç›‘æ§
2. **æ—¥å¿—èšåˆ**: ELK Stackæ—¥å¿—åˆ†æ
3. **å¤‡ä»½ç­–ç•¥**: æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
4. **æ‰©å±•æ€§**: Kubernetesé›†ç¾¤éƒ¨ç½²
5. **å®‰å…¨åŠ å›º**: HTTPSè¯ä¹¦ï¼ŒAPIé™æµ

## ğŸ“ æ”¯æŒä¿¡æ¯

- **é¡¹ç›®ä»“åº“**: https://github.com/tyj1987/lease-calculator
- **ç»´æŠ¤è€…**: tuoyongjun1987@qq.com
- **æ–‡æ¡£**: docs/README.md
- **APIæ–‡æ¡£**: docs/API.md

---
*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')*
*CI/CDçŠ¶æ€: é…ç½®å®Œæˆï¼Œç­‰å¾…éªŒè¯*
